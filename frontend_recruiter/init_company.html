<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/svg" href="./assets/images/vietnamworks_256x256.png" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Init company</title>
    <link rel="stylesheet" href="./assets/css/output.css">
    <!-- toast lib -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.css">
    <script src="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.js"></script>

</head>

<body class="bg-[#f1f5fb] flex flex-col items-center justify-center min-h-screen">
    <!-- <div class="flex flex-col w-full"> -->
    <div class="flex justify-start w-[720px]">
        <h1 class="text-[24px] font-bold my-3 text-center ">Create company information</h1>
    </div>
    <div class="bg-white my-3 p-5 rounded-lg shadow-lg w-[720px]">
        <!-- Logo Placeholder -->
        <div class="flex justify-center mb-6">
            <div class="relative">
                <div class="w-24 h-24 overflow-hidden bg-gray-200 rounded-full flex items-center justify-center">
                    <img id="preview" class="w-full h-full hidden"
                        src="./assets/images/wallpaperflare.com_wallpaper (2).jpg" alt="">
                    <span id="temp_avt" class="!text-[14px] text-gray-500">Avatar</span>
                </div>
                <div class="w-[30px] h-[30px] bg-gray-400 rounded-[50%] absolute top-[70px] right-[2px] ">
                    <div class="flex justify-center items-center h-full text-white hover:cursor-pointer">
                        <input type="file" id="logoUpload" accept="image/*" class="hidden">
                        <label for="logoUpload" class="hover:cursor-pointer">
                            <ion-icon name="camera-outline"></ion-icon>
                        </label>
                    </div>
                </div>
            </div>
        </div>


        <div class="grid grid-cols-2 gap-4">
            <!-- Mã số thuế -->
            <div>
                <label class="block text-sm font-medium text-gray-700">Tax code<span
                        class="text-red-500">*</span></label>
                <input id="tax_code" type="text" required
                    class="mt-1 block w-full px-2 py-1.5 border border-gray-300 rounded-md hover:border-[#0169dd] focus:border-[#0169dd] focus:outline-none"
                    placeholder="Enter the tax code">
            </div>

            <!-- Tên công ty -->
            <div>
                <label class="block text-sm font-medium text-gray-700">Company name<span
                        class="text-red-500">*</span></label>
                <input id="company_name" type="text" required
                    class="mt-1 block w-full px-2 py-1.5 border border-gray-300 rounded-md hover:border-[#0169dd] focus:border-[#0169dd] focus:outline-none"
                    placeholder="Enter the company name">
            </div>

            <!-- Website -->
            <div>
                <label class="block text-sm font-medium text-gray-700">Website</label>
                <div class="mt-1 flex items-center">
                    <input id="website_company" type="text" value="https://" required
                        class="block w-full px-2 py-1.5 border border-gray-300 rounded-md hover:border-[#0169dd] focus:border-[#0169dd] focus:outline-none"
                        placeholder="Enter the website">
                </div>
            </div>

            <!-- Quy mô -->
            <div>
                <label class="block text-sm font-medium text-gray-700">Scale<span class="text-red-500">*</span></label>
                <select id="scale_company"
                    class="mt-1 block w-full px-2 py-1.5 border border-gray-300 rounded-md hover:border-[#0169dd] focus:border-[#0169dd] focus:outline-none">
                    <option value="1-9">1-9 members</option>
                    <option value="10-24">10-24 members</option>
                    <option value="25-99">25-99 members</option>
                    <option value="100-499">100-499 members</option>
                    <option value="500-1000">500-1000 members</option>
                    <option value="1000+">1000+</option>
                    <option value="3000+">3000+</option>
                    <option value="5000+">5000+</option>
                </select>
            </div>

            <!-- Địa chỉ -->
            <div>
                <label class="block text-sm font-medium text-gray-700">Address<span
                        class="text-red-500">*</span></label>
                <input id="address_company" type="text" required
                    class="mt-1 block w-full px-2 py-1.5 border border-gray-300 rounded-md hover:border-[#0169dd] focus:border-[#0169dd] focus:outline-none"
                    placeholder="Enter the address">
            </div>

            <!-- Email -->
            <div>
                <label class="block text-sm font-medium text-gray-700">Email <span class="text-red-500">*</span></label>
                <input id="email_company" type="email" required
                    class="mt-1 block w-full px-2 py-1.5 border border-gray-300 rounded-md hover:border-[#0169dd] focus:border-[#0169dd] focus:outline-none"
                    placeholder="Enter the email">
            </div>

            <!-- Số điện thoại -->
            <div>
                <label class="block text-sm font-medium text-gray-700">Phone number<span
                        class="text-red-500">*</span></label>
                <input id="phone_number" type="text" required
                    class="mt-1 block w-full px-2 py-1.5 border border-gray-300 rounded-md hover:border-[#0169dd] focus:border-[#0169dd] focus:outline-none"
                    placeholder="Enter the phone number">
            </div>
        </div>

        <!-- Text Editor Placeholder -->
        <div class="mt-4">
            <label class="block text-sm font-medium text-gray-700 mb-1">Introduction</label>
            <!-- <textarea id="description_company" name="description" required class="editor"></textarea> -->
            <!-- <textarea name="" id=""></textarea> -->
            <textarea id="description" rows="10" placeholder="Briefly writer about the your company..."
                class="w-full px-4 py-3 rounded-xl border border-gray-300 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-800 resize-none transition duration-200"></textarea>
        </div>

        <button onclick="sendInfCompany()" class="w-full flex justify-end hover:cursor-pointer">
            <div class=" px-3 py-1.5 max-w-fit flex flex-row items-center bg-black rounded-2xl mt-4">
                <h5 class="text-white mr-1">Next step: </h5>
                <p class="text-[#43b1b7] mr-1">Verify company</p>
                <ion-icon class="text-white content-center text-2xl mt-0.5" name="arrow-forward-outline"></ion-icon>
            </div>
        </button>
    </div>
    <!-- </div> -->

    <!-- ion-icon -->
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>

    <!-- xử lý gửi thông tin -->
    <script>
        async function sendInfCompany() {
            const tax_code = document.getElementById("tax_code").value;
            const company_name = document.getElementById("company_name").value;
            const website_company = document.getElementById("website_company").value;
            const scale_company = document.getElementById("scale_company").value;
            const address_company = document.getElementById("address_company").value;
            const email_company = document.getElementById("email_company").value;
            const phone_number = document.getElementById("phone_number").value;
            const description_company = document.getElementById("description").value; // Lấy nội dung từ TinyMCE
            const logo = document.getElementById("logoUpload").files[0];

            const formData = new FormData();
            const companyData = {
                tax_code: tax_code,
                name: company_name,
                website: website_company,
                scale: scale_company,
                address: address_company,
                email: email_company,
                hotline: phone_number,
                introduction: description_company
            };

            formData.append("company", JSON.stringify(companyData));
            if (logo) {
                formData.append("logo", logo);
            }
            var notyf = new Notyf({
                duration: 2500, position: {
                    x: 'right',   // left | center | right
                    y: 'top'
                }, dismissible: true // Có nút tắt hay không
            });
            const user = JSON.parse(localStorage.getItem("user"))
            fetch(`http://localhost:8088/api/v1/company/${user.id}`, {
                method: 'POST',
                body: formData // KHÔNG đặt headers Content-Type, trình duyệt sẽ tự set multipart/form-data
            })
                .then(async (response) => {
                    if (response.ok) {
                        notyf.success('Successful company creation!');
                        setTimeout(function () {
                            window.location.href = "./verify_company.html"
                        }, 2400)
                    }
                    else {
                        const contentType = response.headers.get("content-type") || "";

                        if (contentType.includes("application/json")) {
                            response.json().then(data => {
                                notyf.error(data.message || "Error occurred.");
                            });
                        } else {
                            response.text().then(text => {
                                notyf.error(text || "Error occurred.");
                            });
                        }
                    }

                })
                .catch(async error => {
                    const errorMessage = await error.json()
                    notyf.error(errorMessage.message);
                });
        }
    </script>

    <!-- xử lý preview ảnh -->
    <script>
        // Lấy input file và hình ảnh preview
        const fileInput = document.getElementById('logoUpload');
        const previewImage = document.getElementById('preview');

        // Xử lý khi người dùng chọn file
        fileInput.addEventListener('change', function (event) {
            const file = event.target.files[0]; // Lấy file đầu tiên (vì chỉ chọn 1 file)

            if (file) {
                // Hiển thị ảnh preview
                const reader = new FileReader();
                reader.onload = function (e) {
                    previewImage.classList.remove('hidden');
                    document.getElementById('temp_avt').classList.add('hidden');
                    previewImage.src = e.target.result; // Cập nhật src của thẻ img
                };
                reader.readAsDataURL(file); // Đọc file dưới dạng URL dữ liệu
            }
        });
    </script>
</body>

</html>